<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Troubleshooting  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Troubleshooting  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
           Docs
        </a>
         (68% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/mxcl/PromiseKit">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Fpromisekit%2Eorg%2Freference%2Fdocsets%2F%2Exml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html"> Reference</a>
      <img class="carat" src="img/carat.png" />
      Troubleshooting  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="appendix.html">Appendix</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="commonpatterns.html">CommonPatterns</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="faq.html">FAQ</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="gettingstarted.html">GettingStarted</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="installation.html">Installation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="objectivec.html">ObjectiveC</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="readme.html">README</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="troubleshooting.html">Troubleshooting</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Box.html">Box</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/EmptyBox.html">EmptyBox</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Guarantee.html">Guarantee</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Handlers.html">Handlers</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PMKFinalizer.html">PMKFinalizer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Promise.html">Promise</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Resolver.html">Resolver</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/SealedBox.html">SealedBox</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/__AnyPromise.html">__AnyPromise</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Global Variables.html">Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Global Variables.html#/s:10PromiseKit4confAA16PMKConfigurationVvp">conf</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CatchPolicy.html">CatchPolicy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/LogEvent.html">LogEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PMKError.html">PMKError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PMKNamespacer.html">PMKNamespacer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PMKUnambiguousInitializer.html">PMKUnambiguousInitializer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Result.html">Result</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Sealant.html">Sealant</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/AnyPromise.html">AnyPromise</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/DispatchQueue.html">DispatchQueue</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Error.html">Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Optional.html">Optional</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/PromiseKit.html">PromiseKit</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/PromiseKit/Result.html">– Result</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Thread.html">Thread</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit5afteryAA9GuaranteeCyytG8Dispatch0E12TimeIntervalOF">after(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit5after7secondsAA9GuaranteeCyytGSd_tF">after(seconds:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit7firstly7executeAA0A0Cy1TQzGxyKXE_tAA8ThenableRzlF">firstly(execute:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit7firstly7executeAA9GuaranteeCyxGAFyXE_tlF">firstly(execute:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4hangyxAA0A0CyxGKlF">hang(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4raceyAA0A0Cy1TQzGSayxGAA8ThenableRzlF">race(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4raceyAA0A0Cy1TQzGxd_tAA8ThenableRzlF">race(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4raceyAA9GuaranteeCyxGAEd_tlF">race(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4whenyAA9GuaranteeCyytGAEd_tF">when(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when9fulfilledAA0A0CySay1TQzGGSayxG_tAA8ThenableRzlF">when(fulfilled:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when9fulfilledAA0A0CyytGSayxG_tAA8ThenableRzyt1TRtzlF">when(fulfilled:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when9fulfilledAA0A0CyytGxd_tAA8ThenableRzyt1TRtzlF">when(fulfilled:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when9fulfilled_AA0A0Cy1TQz_AFQy_tGx_q_tAA8ThenableRzAaJR_r0_lF">when(fulfilled:_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when9fulfilled__AA0A0Cy1TQz_AFQy_AFQy0_tGx_q_q0_tAA8ThenableRzAaKR_AaKR0_r1_lF">when(fulfilled:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when9fulfilled___AA0A0Cy1TQz_AFQy_AFQy0_AFQy1_tGx_q_q0_q1_tAA8ThenableRzAaLR_AaLR0_AaLR1_r2_lF">when(fulfilled:_:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when9fulfilled____AA0A0Cy1TQz_AFQy_AFQy0_AFQy1_AFQy2_tGx_q_q0_q1_q2_tAA8ThenableRzAaMR_AaMR0_AaMR1_AaMR2_r3_lF">when(fulfilled:_:_:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when9fulfilled12concurrentlyAA0A0CySay7Element_1TQZGGx_SitStRzAA8ThenableAGRpzlF">when(fulfilled:concurrently:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when10guaranteesAA9GuaranteeCyytGSayAFG_tF">when(guarantees:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when8resolvedAA9GuaranteeCySayAA6ResultOyxGGGAA0A0CyxGd_tlF">when(resolved:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4when8resolvedAA9GuaranteeCySayAA6ResultOyxGGGSayAA0A0CyxGG_tlF">when(resolved:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4wrapyAA0A0CyxGyys5Error_pSg_xSgtcKXElF">wrap(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4wrapyAA0A0CyxGyyxSg_s5Error_pSgtcKXElF">wrap(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4wrapyAA0A0CyxGyyx_s5Error_pSgtcKXElF">wrap(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4wrapyAA0A0CyxGyyxcKXElF">wrap(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10PromiseKit4wrapyAA0A0CyytGyys5Error_pSgcKXEF">wrap(_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CancellableError.html">CancellableError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CatchMixin.html">CatchMixin</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Thenable.html">Thenable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PMKConfiguration.html">PMKConfiguration</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='troubleshooting' class='heading'>Troubleshooting</h1>
<h2 id='compilation-errors' class='heading'>Compilation errors</h2>

<p>99% of compilation issues involving PromiseKit can be addressed or diagnosed by one of the fixes below.</p>
<h3 id='check-your-handler' class='heading'>Check your handler</h3>
<pre class="highlight swift"><code><span class="k">return</span> <span class="n">firstly</span> <span class="p">{</span>
      <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="o">.</span><span class="n">promise</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span>
    <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="nv">$0</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">dict</span> <span class="k">in</span>
    <span class="kt">User</span><span class="p">(</span><span class="nv">dict</span><span class="p">:</span> <span class="n">dict</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Swift (unhelpfully) says:</p>

<blockquote>
<p>Cannot convert value of type &lsquo;([String : Any]) -&gt; User&rsquo; to expected argument type &lsquo;([String : Any]) -&gt; _&rsquo;</p>
</blockquote>

<p>What’s the real problem? <code>then</code> <em>must</em> return a <code><a href="Classes/Promise.html">Promise</a></code>, and you&rsquo;re trying to return something else. What you really want is <code>map</code>:</p>
<pre class="highlight swift"><code><span class="k">return</span> <span class="n">firstly</span> <span class="p">{</span>
      <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="o">.</span><span class="n">promise</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span>
    <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="nv">$0</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span>
<span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">dict</span> <span class="k">in</span>
    <span class="kt">User</span><span class="p">(</span><span class="nv">dict</span><span class="p">:</span> <span class="n">dict</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h3 id='specify-closure-parameters-strong-and-strong-return-type' class='heading'>Specify closure parameters <strong>and</strong> return type</h3>

<p>For example:</p>
<pre class="highlight swift"><code><span class="k">return</span> <span class="n">firstly</span> <span class="p">{</span>
    <span class="nf">foo</span><span class="p">()</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">user</span> <span class="k">in</span>
    <span class="c1">//…</span>
    <span class="k">return</span> <span class="nf">bar</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>This code may compile if you specify the type of <code>user</code>:</p>
<pre class="highlight swift"><code><span class="k">return</span> <span class="n">firstly</span> <span class="p">{</span>
    <span class="nf">foo</span><span class="p">()</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="p">(</span><span class="nv">user</span><span class="p">:</span> <span class="kt">User</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">//…</span>
    <span class="k">return</span> <span class="nf">bar</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>If it still doesn&rsquo;t compile, perhaps you need to specify the return type, too:</p>
<pre class="highlight swift"><code><span class="k">return</span> <span class="n">firstly</span> <span class="p">{</span>
    <span class="nf">foo</span><span class="p">()</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="p">(</span><span class="nv">user</span><span class="p">:</span> <span class="kt">User</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">Bar</span><span class="o">&gt;</span> <span class="k">in</span>
    <span class="c1">//…</span>
    <span class="k">return</span> <span class="nf">bar</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>We have made great effort to reduce the need for explicit typing in PromiseKit 6, 
but as with all Swift functions that return a generic type (e.g., <code>Array.map</code>),
you may need to explicitly tell Swift what a closure returns if the closure&rsquo;s body is
longer than one line.</p>

<blockquote>
<p><em>Tip</em>: Sometimes you can force a one-liner by using semicolons.</p>
</blockquote>
<h3 id='acknowledge-all-incoming-closure-parameters' class='heading'>Acknowledge all incoming closure parameters</h3>

<p>Swift does not permit you to silently ignore a closure&rsquo;s parameters. For example, this code:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">_</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">Void</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">firstly</span> <span class="p">{</span>
        <span class="n">proc</span><span class="o">.</span><span class="nf">launch</span><span class="p">(</span><span class="o">.</span><span class="n">promise</span><span class="p">)</span>      <span class="c1">// proc: Foundation.Process</span>
    <span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span>
        <span class="nf">when</span><span class="p">(</span><span class="nv">fulfilled</span><span class="p">:</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>    <span class="c1">// both p1 &amp; p2 are `Promise&lt;Void&gt;`</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Fails to compile with the error:</p>
<pre class="highlight plaintext"><code>Cannot invoke 'then' with an argument list of type '(() -&gt; _)
</code></pre>

<p>What&rsquo;s the problem? Well, <code>Process.launch(.promise)</code> returns
<code>Promise&lt;(String, String)&gt;</code>, and we are ignoring this value in our <code>then</code> closure. 
If we’d referenced <code>$0</code> or named the parameter, Swift would have been satisfied.</p>

<p>Assuming that we really do want to ignore the argument, the fix is to explicitly
acknowledge its existence by assigning it the name <q>_</q>. That&rsquo;s Swift-ese for <q>I
know there&rsquo;s a value here, but I&rsquo;m ignoring it.</q></p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">_</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">Void</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">firstly</span> <span class="p">{</span>
        <span class="n">proc</span><span class="o">.</span><span class="nf">launch</span><span class="p">(</span><span class="o">.</span><span class="n">promise</span><span class="p">)</span>
    <span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
        <span class="nf">when</span><span class="p">(</span><span class="nv">fulfilled</span><span class="p">:</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>In this situation, you won&rsquo;t always receive an error message that&rsquo;s as clear as the
one shown above. Sometimes, a missing closure parameter sends Swift scurrying off
into type inference limbo. When it finally concludes that there&rsquo;s no way for it to make
all the inferred types work together, it may end up assigning blame to some other
closure entirely and giving you an error message that makes no sense at all.</p>

<p>When faced with this kind of enigmatic complaint, a good rule of thumb is to
double-check your argument and return types carefully. If everything looks OK, 
temporarily add explicit type information as shown above, just to rule
out mis-inference as a possible cause.</p>
<h3 id='try-moving-code-to-a-temporary-inline-function' class='heading'>Try moving code to a temporary inline function</h3>

<p>Try taking the code out of a closure and putting it in a standalone function. Now Swift
will give you the <em>real</em> error message. For example:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">doStuff</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">firstly</span> <span class="p">{</span>
        <span class="nf">foo</span><span class="p">()</span>
    <span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">bar</span> <span class="o">=</span> <span class="nf">bar</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">baz</span> <span class="o">=</span> <span class="nf">baz</span><span class="p">()</span>
        <span class="nf">when</span><span class="p">(</span><span class="nv">fulfilled</span><span class="p">:</span> <span class="n">bar</span><span class="p">,</span> <span class="n">baz</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Becomes:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">doStuff</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">fluff</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="err">…</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">bar</span> <span class="o">=</span> <span class="nf">bar</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">baz</span> <span class="o">=</span> <span class="nf">baz</span><span class="p">()</span>
        <span class="nf">when</span><span class="p">(</span><span class="nv">fulfilled</span><span class="p">:</span> <span class="n">bar</span><span class="p">,</span> <span class="n">baz</span><span class="p">)</span>  
    <span class="p">}</span>

    <span class="n">firstly</span> <span class="p">{</span>
        <span class="nf">foo</span><span class="p">()</span>
    <span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span>
        <span class="nf">fluff</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>An <em>inline</em> function like this is all you need. Here, the problem is that you
forgot to mark the last line of the closure with an explicit <code>return</code>. It&rsquo;s required
here because the closure is longer than one line.</p>
<h2 id='you-copied-code-off-the-internet-that-doesn-t-work' class='heading'>You copied code off the Internet that doesn’t work</h2>

<p>Swift has changed a lot over the years and so PromiseKit has had to change to keep
up. The code you copied is probably for an older PromiseKit. <em>Read the definitions of the
functions.</em> It&rsquo;s easy to do this in Xcode by option-clicking or command-clicking function names.
All PromiseKit functions are documented and provide examples.</p>
<h2 id='q-context-type-for-closure-argument-expects-1-argument-which-cannot-be-implicitly-ignored-q' class='heading'><q>Context type for closure argument expects 1 argument, which cannot be implicitly ignored</q></h2>

<p>You have a <code>then</code>; you want a <code>done</code>.</p>
<h2 id='q-missing-argument-for-parameter-1-in-call-q' class='heading'><q>Missing argument for parameter #1 in call</q></h2>

<p>This is part of Swift 4’s “tuplegate”.</p>

<p>You must specify your <code>Void</code> parameter:</p>
<pre class="highlight swift"><code><span class="n">seal</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">(())</span>
</code></pre>

<p>Yes: we hope they revert this change in Swift 5 too.</p>
<h2 id='q-ambiguous-reference-to-firstly-execute-q' class='heading'><q>Ambiguous reference to &lsquo;firstly(execute:)&rsquo;</q></h2>

<p>Remove the firstly, eg:</p>
<pre class="highlight swift"><code><span class="n">firstly</span> <span class="p">{</span>
    <span class="nf">foo</span><span class="p">()</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span>
    <span class="c1">//…</span>
<span class="p">}</span>
</code></pre>

<p>becomes: </p>
<pre class="highlight swift"><code><span class="nf">foo</span><span class="p">()</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span>
    <span class="c1">//…</span>
<span class="p">}</span>
</code></pre>

<p>Rebuild and Swift should now tell you the <em>real</em> error.</p>
<h2 id='other-issues' class='heading'>Other issues</h2>
<h3 id='code-pending-promise-deallocated-code' class='heading'><code>Pending Promise Deallocated!</code></h3>

<p>If you see this warning, you have a path in your <code><a href="Classes/Promise.html">Promise</a></code> initializer that allows
the promise to escape without being sealed:</p>
<pre class="highlight swift"><code><span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">seal</span> <span class="k">in</span>
    <span class="n">task</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
            <span class="n">seal</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
            <span class="n">seal</span><span class="o">.</span><span class="nf">reject</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>There are two missing paths here, and if either occurs, the promise will soon be
deallocated without resolving. This will manifest itself as a bug in your app,
probably the awful infinite spinner.</p>

<p>So let’s be thorough:</p>
<pre class="highlight swift"><code><span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">seal</span> <span class="k">in</span>
    <span class="n">task</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">{</span>
            <span class="nf">fulfill</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
            <span class="nf">reject</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nf">reject</span><span class="p">(</span><span class="kt">MyError</span><span class="o">.</span><span class="n">valueNotString</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// should never happen, but we have an `PMKError` for task being called with `nil`, `nil`</span>
            <span class="nf">reject</span><span class="p">(</span><span class="kt">PMKError</span><span class="o">.</span><span class="n">invalidCallingConvention</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>If this seems tedious, it shouldn’t. You would have to be this thorough without promises, too.
The difference is that without promises, you wouldn’t get a warning in the console notifying
you of your mistake!</p>
<h3 id='slow-compilation-compiler-cannot-solve-in-reasonable-time' class='heading'>Slow compilation / compiler cannot solve in reasonable time</h3>

<p>Add return types to your closures.</p>
<h3 id='my-promise-never-resolves' class='heading'>My promise never resolves</h3>

<p>There are several potential causes:</p>
<h4 id='1-check-to-be-sure-that-your-asynchronous-task-even-em-starts-em' class='heading'>1. Check to be sure that your asynchronous task even <em>starts</em></h4>

<p>You’d be surprised how often this is the cause.</p>

<p>For example, if you are using <code>URLSession</code> without our extension (but
don’t do that; <em>use</em> our extension! we know all the pitfalls), did you forget
to call <code>resume</code> on the task? If so, the task never actually starts, and so of
course it never finishes, either.</p>
<h4 id='2-check-that-all-paths-in-your-custom-promise-initializers-are-handled' class='heading'>2. Check that all paths in your custom Promise initializers are handled</h4>

<p>See “Pending Promise Deallocated” above. Usually you will see this warning if
you are not handling a path, but that requires your promise deallocate, so you
may not see this warning yet you are still not handling all paths.</p>

<p>Unhandled paths mean the promise will not resolve.</p>
<h4 id='3-ensure-the-queue-your-promise-handler-runs-upon-is-not-blocked' class='heading'>3. Ensure the queue your promise handler runs upon is not blocked</h4>

<p>If the thread is blocked the handlers cannot execute. Commonly you can see this
if you are using our <code>wait()</code> function. Please read the documentation for <code>wait()</code>
for suggestions and caveats.</p>
<h3 id='code-result-of-call-to-39-done-on-_-39-is-unused-code-code-result-of-call-to-39-then-on-_-39-is-unused-code' class='heading'><code>Result of call to &#39;done(on:_:)&#39; is unused</code>, <code>Result of call to &#39;then(on:_:)&#39; is unused</code></h3>

<p>PromiseKit deliberately avoids the <code>@discardableResult</code> annotation because the
unused result warning is a hint that you have not handled the error in your
chain. So do one of these:</p>

<ol>
<li>Add a <code>catch</code></li>
<li><code>return</code> the promise (thus punting the error handling to the caller)</li>
<li>Use <code>cauterize()</code> to silence the warning.</li>
</ol>

<p>Obviously, do 1 or 2 in preference to 3.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2019 <a class="link" href="" target="_blank" rel="external"></a>. All rights reserved. (Last updated: 2019-01-15)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.4</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
